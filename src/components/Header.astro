---
/**
 * Header — Navigation minimaliste architecturale
 * Glassmorphism subtil, pas de SVG corners, boutons carres
 */
import Container from '@components/ui/Container.astro';

const pathname = Astro.url.pathname;
const navLinks = [
  { href: '/', label: 'Accueil' },
  { href: '/projets', label: 'Projets' },
  { href: '/expertise', label: 'Expertise' },
  { href: '/a-propos', label: 'A propos' },
  { href: '/contact', label: 'Contact' },
];

function isActive(href: string) {
  if (href === '/') return pathname === '/';
  return pathname.startsWith(href);
}
---

<header
  id="main-nav"
  class="fixed top-0 left-0 right-0 z-sticky transition-all duration-500"
  style="background: rgba(253,251,247,0.95); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border-bottom: 1px solid rgba(0,0,0,0.06);"
>
  <Container>
    <nav class="flex items-center justify-between h-[88px]">

      {/* Logo */}
      <a href="/" class="font-display text-2xl text-primary-dark hover:opacity-100">
        SB Design
      </a>

      {/* Navigation desktop */}
      <ul class="hidden lg:flex items-center gap-10">
        {navLinks.map((link) => (
          <li>
            <a
              href={link.href}
              class:list={[
                'inline-block overflow-hidden relative group font-heading text-[15px] font-medium transition-opacity duration-300',
                isActive(link.href)
                  ? 'text-accent-brown'
                  : 'text-primary-dark hover:opacity-60',
              ]}
              aria-current={isActive(link.href) ? 'page' : undefined}
            >
              <span class="block transition-transform duration-500 ease-out-quart group-hover:-translate-y-full">
                {link.label}
              </span>
              <span class="block absolute top-full left-0 w-full transition-transform duration-500 ease-out-quart group-hover:-translate-y-full" aria-hidden="true">
                {link.label}
              </span>
            </a>
          </li>
        ))}
      </ul>

      {/* CTA — square architectural */}
      <div class="hidden lg:block">
        <a
          href="/contact"
          class="inline-flex items-center px-7 py-3 bg-primary-dark text-white font-heading text-[15px] font-medium hover:bg-[#333] transition-colors duration-500"
        >
          Demander un devis
        </a>
      </div>

      {/* Hamburger mobile */}
      <button
        id="mobile-menu-toggle"
        class="lg:hidden p-2 -mr-2"
        aria-label="Ouvrir le menu"
        aria-expanded="false"
      >
        <svg id="menu-icon-open" class="w-6 h-6 text-primary-dark" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
        <svg id="menu-icon-close" class="w-6 h-6 text-primary-dark hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>

    </nav>
  </Container>

  {/* Menu mobile — fullscreen overlay, large architectural text */}
  <div
    id="mobile-menu"
    class="lg:hidden fixed inset-0 top-[88px] bg-background/98 backdrop-blur-lg opacity-0 pointer-events-none transition-opacity duration-500 z-40"
  >
    <div class="flex flex-col items-center justify-center h-full gap-8 -mt-[88px]">
      {navLinks.map((link) => (
        <a
          href={link.href}
          class:list={[
            'font-heading text-[clamp(28px,5vw,42px)] font-light uppercase tracking-widest transition-opacity duration-300',
            isActive(link.href)
              ? 'text-accent-brown'
              : 'text-primary-dark hover:opacity-60',
          ]}
        >
          {link.label}
        </a>
      ))}
      <div class="mt-4">
        <a
          href="/contact"
          class="inline-flex items-center px-8 py-4 bg-primary-dark text-white font-heading text-base font-medium uppercase tracking-wider"
        >
          Demander un devis
        </a>
      </div>
    </div>
  </div>
</header>

{/* Spacer pour compenser le header fixed */}
<div class="h-[88px]"></div>

<script>
  // Mobile menu toggle
  const toggle = document.getElementById('mobile-menu-toggle');
  const menu = document.getElementById('mobile-menu');
  const iconOpen = document.getElementById('menu-icon-open');
  const iconClose = document.getElementById('menu-icon-close');

  if (toggle && menu && iconOpen && iconClose) {
    toggle.addEventListener('click', () => {
      const isOpen = menu.classList.contains('opacity-100');

      if (isOpen) {
        menu.classList.remove('opacity-100', 'pointer-events-auto');
        menu.classList.add('opacity-0', 'pointer-events-none');
        iconOpen.classList.remove('hidden');
        iconClose.classList.add('hidden');
        toggle.setAttribute('aria-expanded', 'false');
        document.body.style.overflow = '';
      } else {
        menu.classList.remove('opacity-0', 'pointer-events-none');
        menu.classList.add('opacity-100', 'pointer-events-auto');
        iconOpen.classList.add('hidden');
        iconClose.classList.remove('hidden');
        toggle.setAttribute('aria-expanded', 'true');
        document.body.style.overflow = 'hidden';
      }
    });
  }

  // Scroll state — border opacity increases on scroll
  const nav = document.getElementById('main-nav');

  if (nav) {
    const onScroll = (scrollY: number) => {
      if (scrollY > 100) {
        nav.style.borderBottomColor = 'rgba(0,0,0,0.12)';
      } else {
        nav.style.borderBottomColor = 'rgba(0,0,0,0.06)';
      }
    };

    const lenis = (window as any).__lenis;
    if (lenis) {
      lenis.on('scroll', (e: any) => onScroll(e.animatedScroll));
    } else {
      window.addEventListener('scroll', () => onScroll(window.scrollY));
    }
  }
</script>
